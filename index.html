<head>
	<script src="jquery-1.11.3.min.js"></script>
</head>
<body>
	<h1>Youtube to mp3 Conversion</h1>
	<form action="##" id="url_form">
		Please paste the youtube URL here: 
		<input type='text' name='youtube_url' id="yurl">
		<input type='submit'>
	</form>

	<script type="text/javascript">
		$('#url_form [type=submit]').click(function(e){
			console.log("Submit, Data: " + $("#yurl").val())
		   	e.preventDefault();		//prevents default form submit.

		   	// create download info section
			if($("#download-info").length == 0) {
				dl = $(document.createElement("div"))
				dl.attr("id","download-info")
				dl.appendTo("body")
			}
			$("#download-info").empty()
			$("<p>", {
				"html": "Downloading the video from Youtube and converting it..."
			}).appendTo("#download-info")
			console.log("Sending Ajax request.")
		   	$.ajax({    
		     	url:'backend.php',
		     	data:{
		     		"youtube_url":$("#yurl").val(),
		     		"op":"convert"
		     	},
		     	success :function(data, status){
			     	console.log("Data has been returned:" + data)

			     	data_json = JSON.parse(data)
					
					// create download link:
					if(data_json["return"] == "0" && data_json["vid"] != "undefined") {
						// the first time user do the conversion
						$("<a>", {
							"id": "download-link",
							 "href": "backend.php?vid=" + data_json["vid"] + "&op=download",
							 "html": "Download Link"
						}).appendTo("#download-info")

					} else {
						$("<p>", {
							"html" : "Convertion Failed: " + data_json["output"]
						}).appendTo("#download-info")
						//console.log("data: " + data + " status: " + status)
					}
		     	}
		   }); 
		}); 
	</script>
</body>